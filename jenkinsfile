node(){
    stage("pre-flight"){
        deleteDir()
        git branch: 'development', url: 'https://github.com/robnester-rh/hdsl_test'
        env.buildParameters = [:]
    }
    stage("set build configurations"){
        addBuildParameters(
            [
                string(defaultValue: 'flotsam', description: 'One part of a shipwreck', name: 'FLOTSAM'),
                string(defaultValue: 'jetsam', description: 'Another part of a shipwreck', name: 'JETSAM'),

            ]
        )
        addBuildConfiguration(
            [
                $class: 'BuildConfigProjectProperty',
                name: '',
                namespace: '',
                resourceVersion: '',
                uid: ''
            ],
            gitLabConnection('gitlab-tlv'),
            [
                $class: 'RebuildSettings',
                autoRebuild: false,
                rebuildDisabled: false
            ],
      )

      setBuildParameters()

    }

    stage("Parse Configuration"){
        parseConfigYaml()
    }
    stage("Deploy Infra"){
        deployInfra()
    }
    stage("Test Pinfile"){
        sh "pwd"
        sh "ls -lah *"
        a = readFile 'linchpin/PinFile'
        echo "PinFile Content:\n${a}"
    }
    archiveArtifacts '*, linchpin/*'

}
